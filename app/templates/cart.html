{% extends "base.html" %}
{% block title %}Cart{% endblock %}
{% block content %}
    <h1>Shopping Cart</h1>
    <table class="purchases_table">
        <tr>
            <th></th>
            <th>Item</th>
            <th>Price</th>
            <th>Quantity</th>
        </tr>
        {% for item in cart %}
            <script>
                function buttonClick(x ) {
                    var value = parseInt(document.getElementById('inc').value, 10);
                    value = isNaN(value) ? 0 : value;
                    alert(x)
                    params = x
                    let xhr = new XMLHttpRequest();
                    xhr.open('POST', "/edit_cart_quantity", true)
                    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                    xhr.onreadystatechange = function () {//Call a function when the state changes.
                        if (xhr.readyState == 4 && xhr.status == 200) {
                            console.log(xhr.responseText);
                        }
                        xhr.send(params);
                    }
                }
            </script>

        <tr>
            <td></td>
            <td><div><a class="action" href="{{ url_for('item', id=item.Item.id) }}">{{ item.Item.name }}</a></div></td>
            <td><button onclick='buttonClick({{ item.Item.id|tojson }})'>+</button>
                <input type="text" id="inc" value={{ item.Cart.cart_quantity }} /><br>
                <a class="action" href="{{ url_for('delete_from_cart', item_id=item.Item.id) }}">Delete</a>
            </td>
            <td id="price">$
                <script type="text/javascript">
                    var StringValue = parseFloat({{ item.Item.price|tojson }});
                    document.write(StringValue.toFixed( 2 ));
                </script>
            </td>
        </tr>
        {% endfor %}
        <tr>
            <td>Total</td>
            <td></td>
            <td></td>
            <td>$
                <script type="text/javascript">
                    var StringValue = parseFloat({{ price }});
                    document.write(StringValue.toFixed( 2 ));
                </script>
            </td>
        </tr>
    </table>

    <form action="" method="post" novalidate>
        <input type="submit" class="checkout" name="checkout" onclick='return doubleCheck({{ price|tojson }})' value="Checkout">
    </form>

{% endblock %}